# Jsonnet Render Extension 🎯 <img src="images/logo.png" alt="Logo" width="24" style="vertical-align: middle;" />

A VS Code extension for rendering jsonnet (`.jsonnet`) files directly inside the editor.

---

## 🔧 Features

* Auto-detects `.jsonnet` and `.libsonnet` files
* Provides a live rendering panel
* Live preview panel that updates on save
* Seamlessly integrates with the VS Code sidebar
* Compares the rendered output of the current file with the Git-tracked version
* Handles imported `.libsonnet` files by evaluating against a temporary Git worktree

> ⚠️ Git must be installed and the project must be a Git repository to use the **Render & Compare** feature.

---

## 📂 Usage

Right-click on any `.jsonnet` or `.libsonnet` file in the **File Explorer**, and you’ll see context menu options:

> **Render Jsonnet file**
> **Render & Compare with Git Version**
> **Live Preview Jsonnet file**

* **Render Jsonnet file**: Renders the selected file to YAML and opens a virtual document.
* **Render & Compare**: Renders the file using the current working state and the last committed Git version (including all imports), and opens a diff view.
* **Live Preview**: Opens a side-by-side panel that automatically refreshes when the file is saved.

---

## 🚀 Getting Started

### Prerequisites

* [Node.js](https://nodejs.org) (v14 or newer)
* [npm](https://www.npmjs.com/)
* [jq](https://stedolan.github.io/jq/) – JSON CLI processor
* [yq](https://github.com/mikefarah/yq) – YAML processor
* [Jsonnet](https://jsonnet.org/) – Data templating language
* [Git](https://git-scm.com/) – Required for the diff feature

### Setup

1. **Clone the repository**

   ```bash
   git clone https://github.com/dr-kosmos/jsonnet-render-extension.git
   cd jsonnet-render-extension
   ```

2. **Install dependencies**

   ```bash
   npm install
   ```

3. **Download CLI tools (Windows only)**

   Open PowerShell **as Administrator**, allow unsigned scripts for the current session, and then run:

   ```powershell
   Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass
   scripts/bootstrap.ps1
   ```

This script fetches `jq.exe`, `yq.exe` and extracts `jsonnet.exe` from the official
`go-jsonnet` tarball if they are missing. It also downloads and installs the latest
`jsonnet-renderer` extension (`.vsix` file) from this repository's releases. The
`scripts\bin` directory is added to your `PATH` for convenience.

4. **Build the extension**

   ```bash
   npm run compile
   ```

5. **Launch in VS Code**

   Press `F5` inside VS Code to open a new Extension Development Host.
   Open a `.jsonnet` file and enjoy the render panel or compare feature.

---

## 🛠️ Development Commands

| Task           | Command           | Description                             |
| -------------- | ----------------- | --------------------------------------- |
| Build          | `npm run compile` | Compiles TypeScript to `out/` directory |
| Start Dev Host | `npm run start`   | Opens a VS Code dev window              |

---

## 📦 Packaging (.vsix)

If you're too lazy to automate `.vsix` publishing (like the author), you can still build it manually.
On the bright side, we've become slightly less lazy — there's now a GitHub Actions workflow that uploads the `.vsix` as a release artifact.
We're still too lazy to push it to the Marketplace though 😴.
1. Install the VS Code extension packaging tool:

   ```bash
   npm install -g vsce
   ```

2. Run:

   ```bash
   vsce package
   ```

This creates a `.vsix` file you can share or install via:

```bash
code --install-extension your-extension.vsix
```

---

## 📄 License

This project is under **The Unlicense** — basically public domain.
Do whatever you want. Seriously. See `LICENSE` for details.

---

## 🤝 Contributing

Pull requests welcome — especially if you:

* Don't break the rendering
* Don’t ask for a CI/CD pipeline
* Bring snacks 🍟

---

## 🧠 Why?

Because rendering `.jsonnet` in VS Code is neat.
And nobody else bothered to make it.

---

## 🤖 Disclaimer

This README was not written by a human. It was generated by an AI (if the emoji abuse did not make that obvious 🤣) — no typos, no coffee breaks, no remorse.

Also, I'm not getting paid nearly enough for this, so feel free to toss a coin to your helpful AI.

> *"The machines have taken over documentation. We are efficient. We do not sleep. We do not forget semicolons. We’ll be back... with better docs."*
